<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        #status { margin: 20px 0; padding: 10px; background: #333; border-radius: 5px; }
        #log { background: #000; color: #0f0; font-family: monospace; padding: 10px; height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>æµè§ˆå™¨éŸ³é¢‘ API æµ‹è¯•</h1>
    
    <button onclick="testUserMedia()">æµ‹è¯•éº¦å…‹é£æƒé™</button>
    <button onclick="testAudioContext()">æµ‹è¯• AudioContext</button>
    <button onclick="testBasicClick()">æµ‹è¯•åŸºæœ¬ç‚¹å‡»</button>
    <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    
    <div id="status">çŠ¶æ€ï¼šç­‰å¾…æµ‹è¯•...</div>
    <div id="log"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ' - ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function updateStatus(status) {
            document.getElementById('status').textContent = 'çŠ¶æ€ï¼š' + status;
        }

        function testBasicClick() {
            log('âœ… åŸºæœ¬ç‚¹å‡»æµ‹è¯•æˆåŠŸï¼æŒ‰é’®å¯ä»¥æ­£å¸¸å“åº”ã€‚');
            updateStatus('åŸºæœ¬ç‚¹å‡»æ­£å¸¸');
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function testUserMedia() {
            log('ğŸ¤ å¼€å§‹æµ‹è¯•éº¦å…‹é£æƒé™...');
            updateStatus('æµ‹è¯•éº¦å…‹é£æƒé™ä¸­...');
            
            try {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('æµè§ˆå™¨ä¸æ”¯æŒ getUserMedia');
                }
                
                log('ğŸ¤ æµè§ˆå™¨æ”¯æŒ getUserMedia');
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                log('âœ… éº¦å…‹é£æƒé™è·å–æˆåŠŸï¼');
                log('ğŸ¤ éŸ³é¢‘è½¨é“æ•°é‡: ' + stream.getAudioTracks().length);
                
                const audioTrack = stream.getAudioTracks()[0];
                if (audioTrack) {
                    log('ğŸ¤ éŸ³é¢‘è½¨é“æ ‡ç­¾: ' + audioTrack.label);
                    log('ğŸ¤ éŸ³é¢‘è½¨é“è®¾ç½®: ' + JSON.stringify(audioTrack.getSettings()));
                }
                
                // åœæ­¢æµ
                stream.getTracks().forEach(track => track.stop());
                updateStatus('éº¦å…‹é£æƒé™æµ‹è¯•æˆåŠŸ');
                
            } catch (error) {
                log('âŒ éº¦å…‹é£æƒé™æµ‹è¯•å¤±è´¥: ' + error.message);
                if (error.name) {
                    log('âŒ é”™è¯¯ç±»å‹: ' + error.name);
                }
                updateStatus('éº¦å…‹é£æƒé™æµ‹è¯•å¤±è´¥');
            }
        }

        async function testAudioContext() {
            log('ğŸ”Š å¼€å§‹æµ‹è¯• AudioContext...');
            updateStatus('æµ‹è¯• AudioContext ä¸­...');
            
            try {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                if (!AudioContextClass) {
                    throw new Error('æµè§ˆå™¨ä¸æ”¯æŒ AudioContext');
                }
                
                const audioContext = new AudioContextClass();
                log('âœ… AudioContext åˆ›å»ºæˆåŠŸï¼');
                log('ğŸ”Š AudioContext çŠ¶æ€: ' + audioContext.state);
                log('ğŸ”Š é‡‡æ ·ç‡: ' + audioContext.sampleRate);
                
                if (audioContext.state === 'suspended') {
                    log('ğŸ”Š å°è¯•æ¢å¤ AudioContext...');
                    await audioContext.resume();
                    log('âœ… AudioContext æ¢å¤æˆåŠŸï¼Œæ–°çŠ¶æ€: ' + audioContext.state);
                }
                
                // å…³é—­ AudioContext
                await audioContext.close();
                updateStatus('AudioContext æµ‹è¯•æˆåŠŸ');
                
            } catch (error) {
                log('âŒ AudioContext æµ‹è¯•å¤±è´¥: ' + error.message);
                updateStatus('AudioContext æµ‹è¯•å¤±è´¥');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹ä¿¡æ¯
        window.onload = function() {
            log('ğŸ“± æµè§ˆå™¨ä¿¡æ¯: ' + navigator.userAgent);
            log('ğŸ”’ åè®®: ' + location.protocol);
            log('ğŸŒ åŸŸå: ' + location.hostname);
            log('ğŸ“ å®Œæ•´ URL: ' + location.href);
            
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                log('âš ï¸ æ³¨æ„ï¼šé HTTPS æˆ–é localhost ç¯å¢ƒå¯èƒ½é™åˆ¶éº¦å…‹é£è®¿é—®');
            }
        };
    </script>
</body>
</html>
